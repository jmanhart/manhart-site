---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import { fetchCollection } from "../utils/discogsApi.js";
const apiKey = import.meta.env.PUBLIC_DISCOGS_API_TOKEN;

let collection = [];
try {
  collection = await fetchCollection(apiKey);

  // Sort the collection alphabetically by artist name (A-Z)
  collection.sort((a, b) => {
    const artistA = a.basic_information.artists[0]?.name.toLowerCase() || '';
    const artistB = b.basic_information.artists[0]?.name.toLowerCase() || '';
    return artistA < artistB ? -1 : artistA > artistB ? 1 : 0;
  });
} catch (error) {
  console.error('Error fetching collection:', error);
  collection = []; // Fallback to an empty array to prevent build failure
}
---

<html lang="en">
  <head>
    <BaseHead title="All Records" description="My record collection" />
  </head>
  <body>
    <Header />
    <div class="sub-page-wrapper" id="sub-page">
      <div class="root-content text-page">
        <div class="info-container">
          <h2>ðŸŽ¶ All Records</h2>
          <p class="blog-short-description">Album Count: {collection.length}</p>
          <div id="collection-list">
            {collection.length > 0 ? (
              collection.map((release) => (
                <div
                  class="release"
                  key={release.id}
                  style="display: flex; align-items: center; margin-bottom: 15px;"
                >
                  {release.basic_information.cover_image ? (
                    <img
                      src={release.basic_information.cover_image}
                      alt={`Cover of ${release.basic_information.title}`}
                      style="width: 50px; height: 50px; object-fit: cover; margin-right: 15px; border-radius: 5px;"
                    />
                  ) : (
                    <div style="width: 50px; height: 50px; background-color: gray; display: flex; align-items: center; justify-content: center; margin-right: 15px; border-radius: 5px; color: white; font-size: 12px;">
                      :(
                    </div>
                  )}
                  <div>
                    <h3 style="font-style: italic; margin: 0;">
                      {release.basic_information.title}
                    </h3>
                    <p style="margin: 0;">
                      {release.basic_information.artists[0]?.name || 'Unknown Artist'}
                    </p>
                  </div>
                </div>
              ))
            ) : (
              <p>No records found.</p>
            )}
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
